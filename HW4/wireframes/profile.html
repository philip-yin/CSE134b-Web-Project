<!DOCTYPE html>
  <head>
  	<title> Profile </title>
  	<link rel="stylesheet" href="css/styles.css">
  	<meta charset="utf-8"/> 
  	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.10/firebase-storage.js"></script>
	<script src="javascript/common.js"></script>
	<script type="text/javascript">
        var fav  = firebase.database().ref('Favorites');
        var cham = firebase.database().ref('Champions');
    
        firebase.auth().onAuthStateChanged(function(user) {
         if (user) updateFavLabel(user);
        });
      
		window.onload = function(){
            var eqPos = document.cookie.indexOf("=");
            var chamName = document.cookie.substr(0, eqPos);
            
			document.getElementById("champname").innerHTML = chamName;
			var cham = firebase.database().ref("Champions");
			var pic = cham.child(chamName);
		    pic.on("value", function(snapshot){
		      var data = snapshot.val();
		      document.getElementById("image").src = data["image"];
		    });
          
            //check if the chamname is in the database
            user = firebase.auth().currentUser;
            
		}
        
        function updateFavLabel(user){
          var eqPos = document.cookie.indexOf("=");
          var chamName = document.cookie.substr(0, eqPos);
          fav.child(user.uid).on("value",function(snapshot){
            var data = snapshot.val();
            var flag = false;
            for (var key in data) {
              if(data[key].name == chamName) {
                flag = true;
                break;
              }
            }
            if (flag) document.getElementById("favorite").value = "Un-Favorite";
            else document.getElementById("favorite").value = "Favorite";
          });
        }

		
		function change(){
			user = firebase.auth().currentUser;
			if(user){
				var favButton = document.getElementById("favorite").value;
                var eqPos = document.cookie.indexOf("=");
                var chamName = document.cookie.substr(0, eqPos);
              
				if(favButton === "Favorite"){
					alert('Added to Favorites');
					document.getElementById("favorite").value = "Un-Favorite";
					var ref1 = fav.child(user.uid);
                  
                    ref1.push({
                      name: chamName
                    });
				}
				else{
					alert('Removed from Favorites');
					document.getElementById("favorite").value = "Favorite";
                    fav.child(user.uid).on("value",function(snapshot){
                      var data = snapshot.val();
                      for (var key in data) {
                        if(data[key].name == chamName) {
                          var ref1 = fav.child(user.uid).child(key);
                          ref1.remove();
                          break;
                        }
                      }
                    });
				}
			}
			else{
				alert('Not logged in.');
			}
		}
	</script>
  </head>
  
  <body>
	<div class = topbar>
      <h1>LeagueDex</h1>
      <a href="index.html"> Home </a>
      <a href="login.html" id = "inout"> Log In</a>
      <a href="signup.html" id = "status"> Sign Up</a>
      <hr>
    </div>
	<div style = "text-align:center">
	    <h2 id="champname">Champion Name</h2>
	    <p> <input onclick="change()" type="button" id="favorite" value = "Favorite"></p>
		 
		<img id="image" src="" alt="champion-picture" style="width:200px;height:200px;">
		<div class = "bodybox">
		    <h3 style = "text-align: center">Tips...</h3>
		    <p style = "border:solid white 0.5px; width:50%; display:inline-block;"> HOW TO PLAY THIS CHAMPION </p>
		
			<div style = "text-align:center;">
			  <a href="stats.html"> <p>statistics</p> </a>
			  <a href="skills.html"> <p>abilities</p> </a>
			  <a href="masteries.html"> <p>masteries</p> </a>
			  <a href="items.html"> <p>item build</p> </a>
			  <a href="runes.html"> <p>runes</p> </a>
			  <a href="threats.html"> <p>threats</p> </a>
			  <a href="skins.html"> <p>skins</p> </a>
			</div>
		</div>
	</div>
  </body>
</html>